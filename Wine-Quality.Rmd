---
title: "Wine-Quality"
output: word_document
---
```{r echo=FALSE}
# Libraries
library(tidyr)
library(ggplot2)
library(corrplot)
library ("MASS")

```
## Introduction

This report examines data on red variants of the Portuguese "Vinho Verde" wine. The primary goal is to determine the factors most predictive of quality of wine on a scale of 0 to 10, 10 being the best quality of wine. The predictor variables include fixed acidity, volatile acidity, citric acidity, residual sugar, chlorides, free sulfur dioxide, total sulfur dioxide, density, pH, sulphates, and alcohol for a total of 11 physiochemical properities to work with. Unfortunately, the data set did not specify the units on any of the predictor variables. There are a total of 1,599 observations in the data set.

## Exploratory Analysis 
```{r echo=FALSE}
# Read in the data

folder = "C:/Users/Katie/Documents/LUTHER/Senior/MATH327/Project #1"
wine = read.csv(paste (folder, "winequality-red.csv", sep="/"),header=T)

attach (wine)

par (mfrow = c(1, 2))
hist (quality)
boxplot (quality, horizontal = T, xlab="quality", main="Boxplot of Quality")
```
# todo:  skewed left or right?
The distribution of quality of wine is skewed to the left We will take the log and square root of the response to see if this improves our results.

Quality after log transformation:
```{r}
par (mfrow = c(1, 2))
hist (log(quality))
boxplot (log (quality), horizontal = T, xlab="quality", main="Boxplot of log(quality)")
```
The distribution of quality is now greatly skwed-left. We will try a square root transformation instead.

Quality after square root transformation:
```{r}
par (mfrow = c(1, 2))
hist (sqrt(quality))
boxplot (sqrt (quality), horizontal = T, xlab="quality", main="Boxplot of sqrt(quality)")
```
Left skewness is still very apparent. We will continue to explore the distributions of varibles in the wine data set, then come back to perform a Box-Cox analysis after the model has been fit to see if the distribution of the residuals is skewed of which we would need to take a closer look at. 

### Distribution of each variable
```{r}
wine %>% gather() %>% head()
ggplot(gather(wine), aes(value)) + 
    geom_histogram(bins = 8) + 
    facet_wrap(~key, scales = 'free_x')

```
Although density and pH follow a normal and symmetric distribution, predictor variables chlorides and residual sugar are severly right-skewed. Transformations are needed to make these distributions more symmetric.

### Transforming skewed predictor variables to make their distributions more symmetric

Chlorides before transformation:
```{r}
par (mfrow = c(1, 2))
hist (chlorides)
boxplot (chlorides, horizontal = T, xlab="chlorides", main="Boxplot of chlorides")
```
Taking a closer look at chlorides' distribution, it is clear that chlorides are very right skewed. A transformation will be needed to obtain a more symmetric and normal distribution.

Chlorides after transformation:
```{r}
par (mfrow = c(1, 2))
hist (log(chlorides))
boxplot (log(chlorides), horizontal = T, xlab="chlorides", main="Boxplot of Log(chlorides)")

```
After taking the log of the chlorides, they appear to have a more normal and symmetric distribution. We will continue to explore the pros and cons of this transformation as we go to build our first order model.

Residual sugar also showed a right-skewed distribution. We will examine this now more closely.

Residual sugar before transformation:
```{r}
par (mfrow = c(1, 2))
hist (residual_sugar)
boxplot (residual_sugar, horizontal = T, xlab="residual_sugar", main="Boxplot of residual_sugar")

```
The histogram and boxplot both indicate that residual sugar is also skewed. We will look into transforming this predictor variable as well.

Residual sugar after transformation:
```{r}
par (mfrow = c(1, 2))
hist (log(residual_sugar))
boxplot (log(residual_sugar), horizontal = T, xlab="residual_sugar", main="Boxplot of Log(residual_sugar)")

```
Although the log of residual sugar is still fairly right-skewed, this transformation is still an improvement upon the original data and will be continue to be explored as we build our first order model.

## Correlations

```{r}
cormat = cor (wine, use = "complete.obs")
round (cormat, 2)

```

```{r}
pairs(wine)

```

Looking at the correlations between the response and predictor variables, the pairs plot indicates that alochol is the only predictor variable with a fair correlation with quality of wine (r=0.48). The pairs and correlation plots also indicates a strong negative linear relationshp between fixed acidity and pH (r= -0.69) with mild negative linear relationships between volatile acidity and citric acid (r= -0.54), pH and citric acid (r= -0.55), and alcohol and density (r= -0.53). On the other hand, the pairs and correlation plots indicates that the only strong positive linear relationship exists between fixed acidity and density (r=0.63). Strong, but non-linear correlations were found between free sulfur dioxide and total sulfur dioxide (r=0.68) and fixed acidity and citric acid (r=0.68).

 
Additional note, none of the predictor variables in wine dataset are categorical, nor should be.

## First Order Model (all X variables, no transformations)
### Summary and Anova
```{r}
fit1 = lm (quality ~ fixed_acidity + volatile_acidity + citric_acid + residual_sugar + chlorides + free_sulfur_dioxide + total_sulfur_dioxide + density + pH + sulphates + alcohol, data=wine)
summfit1 = summary (fit1, correlation = T)
summary (fit1)
anova(fit1)
```

The $\hat{\beta}$ values for volatile acidity, chlorides, total sulfur dioxide, sulphates, and alcohol are statistically significant to a false-positive rate of $\alpha =.001$. From here forward we refer simply to $\alpha$. The $\hat{\beta}$ values for free sulfer dioxide and pH are statistically significant to $\alpha = .05$. Therefore, we have reason to believe that these predictors likely have some relationship with wine quality. 

The adjusted $R^2$ for this model is 0.3561. This is not a value indicative of a highly precise model. We are not concerned by the magnitude of the difference between $R^2$ and adjusted $R^2$ because they are so close together, at 0.3606 and  0.3561, respectively. We note, however, that the adjusted $R^2$ is lower than the regular $R^2$, which could indicate that we are overfitting the data.

To a level of $\alpha = .001$, we are certain that for predictors fixed acidity, volatile acidity, chlorides, total sulfur dioxide, density, pH, sulphates, and alcohol adding that predictor to the model (in the addition order indicated in the Analysis of Variance Table above) changed the linear relatioship between the combination of predictor variables and the response variable. To a level of $\alpha = .01$, we are sure that the adding free sulfur dioxide as a predictor to the model (in the addition order indicated in the Analysis of Variance Table above) changed the linear relationship between the combination of predictor variables and the response variable.

### Correlations

```{r}
corrplot (summfit1$correlation, method="number", number.cex=0.6)

```

The correlation plot suggests that there is a strong relationship between fixed acidity and the intercept (r=0.77), residual sugar and the intercept (r=0.60), alcohol and the intercept (r=0.76), density and fixed acidity (r=0.79), pH and fixed acidity (r=0.72), pH and residual sugar (r=-0.60), free sulfur dioxide and total sulfur dioxide (r=-0.66), and alcohol and density (r=0.76). A couple of moderate relationships include pH and intercept (r=0.55), alcohol and fixed acidity (r=-0.54), citric acid and volatile acidity (r=0.54), density and pH (r=-0.57), and pH and alcohol (r=0.52). Although these correlations are important to note, the most striking correlation is that of density and intercept with a correlation r=-1.0. This is unusually high and would normally be of concern to us, but because this is only the first fit and we have many more models to try, we will not worry about this particular correlation at the moment.

In summation, there are many predictor variables that are correlated with one another. We should keep an eye on highly correlated predictors so as to avoid taking the cross product of them and possibly creating unstable parameters for new models.  

### Residual Analysis
```{r}
par (mfrow = c(1, 2))
plot (fit1, which = c(1, 2))

``` 
The normal Q-Q plot does not indicate any large departures from normality, though it does indicate that the data is slightly left skewed. 

Given the fact that the response variable is only quasi-continuous, the plot of the residuals vs. fitted values does not indicated that there is non-constant variance. It also suggests that the residuals are linear. Because the residuals are linear and have constant variance, we will not need to do a Box-Cox analysis.

Neither plot suggests there are any outliers. 

## First Order Model (all X variables, with the log of chlorides and residual sugar applied)
### Summary and Anova

```{r}
wine$log_chlorides = log(chlorides)
wine$log_residual_sugar = log(residual_sugar)

fit2 = lm (quality ~ fixed_acidity + volatile_acidity + citric_acid + log_residual_sugar + log_chlorides + free_sulfur_dioxide + total_sulfur_dioxide + density + pH + sulphates + alcohol, data=wine)

summary (fit2)
anova(fit2)

```

The $\hat{\beta}$ values for volatile acidity, log(chlorides), total sulfur dioxide, sulphates, and alcohol are significant to $\alpha = .001$. The $\hat{\beta}$ values for free sulfur dioxide and pH are statistically significant to $\alpha = .05$. The $\hat{\beta}$ for citric acid is statistically significant to $\alpha = .1$.

There are some differences between this model and the model with the predictors that had not been transformed. The log chlorides predictor is in the same category of significance as the chlorides predictor was in the previous model, though the p-value for log chlorides is 0.00011 whereas the p-value for chlorides was 8.37e-06. While neither the log(residual_sugar) predictor nor the residual sugar predictor were significant, log(residual_sugar) has a p-value of 0.26415, whereas residual sugar had a p-value of 0.539600. All of the significant predictors in the previous model are still significant in the transformed model. The only predictor that was not significant in the previous model that is significant in the transformed model is citric acid.

The adjusted $R^2$ for this model is 0.3542, whereas the adjusted $R^2$ for the untransformed model was 0.3561. The adjusted $R^2$ for this model is not a value indicative of a highly precise model, and it is lower than the adjusted $R^2$ for the untransformed model. We are not concerned by the magnitude of the difference between $R^2$ and adjusted $R^2$ because they are so close together, at 0.3587 and  0.3542, respectively. We note, however, that the adjusted $R^2$ is lower than the regular $R^2$, which could indicate that we are overfitting the data.

There is no statistically significant difference between the Analysis of Variance Table for this model and the previous, untransformed model. 

### Residual Analysis
```{r}
par (mfrow = c(1, 2))
plot (fit2, which = c(1, 2))

``` 
Much like the untransformed model, the Normal Q-Q plot does not indicate any large departures from normality and that the data is slightly left-skewed.The Residuals vs Fitted plot also indicates that the residuals are constant and linear.

Neither plot suggests there are any outliers. 

Although much remained the same sine before the transformation, the adjusted $R^2$ for the transformed model did decrease by .0019, albeit, an unsignificant change, a change for the worse nonetheless, and thus we have decided to not transform chlorides and residual sugar when attempting to create newer, and improved models.  

